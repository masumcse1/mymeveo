<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">
    <changeSet id="#2428_20180105" author="EdwardPLegaspi">
        <addColumn tableName="adm_notif_webhooks">
            <column name="http_protocol" type="varchar(10)" />
        </addColumn>
        <sql>UPDATE ${db.schema.adapted}adm_notif_webhooks SET http_protocol='HTTP'</sql>
        <addNotNullConstraint tableName="adm_notif_webhooks" columnName="http_protocol" columnDataType="varchar(10)" />
    </changeSet>
    <changeSet id="#2792_20180110" author="AndriusKarpavicius">
        <sql>CREATE INDEX medina_access_user_id_index ON ${db.schema.adapted}medina_access(acces_user_id)</sql>
    </changeSet>
    <changeSet id="#2792_20180119" author="AndriusKarpavicius">
        <sql>CREATE INDEX counter_period_ci_id ON ${db.schema.adapted}billing_counter_period(counter_instance_id)</sql>
    </changeSet>
    <changeSet author="anasseh" id="#3136_07022018">
        <sql>update ${db.schema.adapted}meveo_job_instance set cf_values = replace (cf_values, 'PaymentCardJob_','PaymentJob_'), job_template = replace(job_template,'PaymentCardJob','PaymentJob') </sql>
        <sql>update ${db.schema.adapted}crm_custom_field_tmpl set code = replace (code, 'PaymentCardJob_','PaymentJob_'), applies_to = replace (applies_to, 'JOB_PaymentCardJob','JOB_PaymentJob') </sql>
    </changeSet>
    <changeSet author="anasseh" id="#2830_15022018">
        <!-- com_sender_config -->
        <addColumn tableName="com_sender_config">
            <column name="address_country_id" type="bigint" />
        </addColumn>
        <addForeignKeyConstraint baseColumnNames="address_country_id" baseTableName="com_sender_config" constraintName="fk_country_id_sender" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
            onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_country" />
        <sql>update ${db.schema.adapted}com_sender_config ae set address_country_id = (select ac.id from ${db.schema.adapted}adm_country ac where upper(ac.description) like '%'|| upper(ae.address_country) ||'%' or
            upper(ac.description_i18n )like '%'|| upper(ae.address_country) ||'%' limit 1) </sql>
        <dropColumn tableName="com_sender_config" columnName="address_country" />

        <!-- crm_provider_contact -->
        <addColumn tableName="crm_provider_contact">
            <column name="address_country_id" type="bigint" />
        </addColumn>
        <addForeignKeyConstraint baseColumnNames="address_country_id" baseTableName="crm_provider_contact" constraintName="fk_country_id_prov_contact" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
            onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_country" />
        <sql>update ${db.schema.adapted}crm_provider_contact ae set address_country_id = (select ac.id from ${db.schema.adapted}adm_country ac where upper(ac.description) like '%'|| upper(ae.address_country) ||'%' or
            upper(ac.description_i18n )like '%'|| upper(ae.address_country) ||'%' limit 1) </sql>
        <dropColumn tableName="crm_provider_contact" columnName="address_country" />

        <!-- crm_provider -->
        <addColumn tableName="crm_provider">
            <column name="address_country_id" type="bigint" />
        </addColumn>
        <addForeignKeyConstraint baseColumnNames="address_country_id" baseTableName="crm_provider" constraintName="fk_country_id_prov" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
            onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_country" />
        <sql>update ${db.schema.adapted}crm_provider ae set address_country_id = (select ac.id from ${db.schema.adapted}adm_country ac where upper(ac.description) like '%'|| upper(ae.address_country) ||'%' or upper(ac.description_i18n
            )like '%'|| upper(ae.address_country) ||'%' limit 1) </sql>
        <dropColumn tableName="crm_provider" columnName="address_country" />

        <!-- ord_order_item -->
        <addColumn tableName="ord_order_item">
            <column name="address_country_id" type="bigint" />
        </addColumn>
        <addForeignKeyConstraint baseColumnNames="address_country_id" baseTableName="ord_order_item" constraintName="fk_country_id_order" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
            onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_country" />
        <sql>update ${db.schema.adapted}ord_order_item ae set address_country_id = (select ac.id from ${db.schema.adapted}adm_country ac where upper(ac.description) like '%'|| upper(ae.address_country) ||'%' or
            upper(ac.description_i18n )like '%'|| upper(ae.address_country) ||'%' limit 1) </sql>
        <dropColumn tableName="ord_order_item" columnName="address_country" />
    </changeSet>
    <changeSet id="#2870_20180129" author="EdwardLegaspi">
        <createTable tableName="dwh_report_extract">
            <column name="id" type="bigint" autoIncrement="${id.auto}">
                <constraints nullable="false" primaryKey="true" primaryKeyName="dwh_report_extract_pkey" />
            </column>
            <column name="version" type="int4" />
            <column name="disabled" type="${type.boolean}" defaultValueNumeric="0">
                <constraints nullable="false" />
            </column>
            <column name="creator" type="varchar(100)" />
            <column name="updater" type="varchar(100)" />
            <column name="created" type="datetime">
                <constraints nullable="false" />
            </column>
            <column name="updated" type="datetime" />
            <column name="code" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="description" type="varchar(255)" />
            <column name="category" type="varchar(50)" />
            <column name="script_type" type="varchar(10)">
            	<constraints nullable="false"/>
           	</column>
            <column name="filename_format" type="varchar(100)">
            	<constraints nullable="false"/>
            </column>
            <column name="sql_query" type="varchar(2000)" />
            <column name="script_instance_id" type="bigint" />
		</createTable>
		<addForeignKeyConstraint baseColumnNames="script_instance_id" baseTableName="dwh_report_extract" constraintName="fk_report_extract_script_instance" deferrable="false" initiallyDeferred="false"
            onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="meveo_script_instance" />
		<createSequence sequenceName="dwh_report_extract_seq" />
		<createTable tableName="dwh_report_extract_params">
            <column name="reportextract_id" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="params" type="varchar(255)" />
            <column name="params_key" type="varchar(255)">
                <constraints nullable="false" />
            </column>
        </createTable>
        <addPrimaryKey columnNames="reportextract_id, params_key" constraintName="pk_report_extract_params" tableName="dwh_report_extract_params" />
    </changeSet>
    
     <changeSet id="#2870_20180129 Mysql" author="EdwardLegaspi" dbms="mysql">
        <createTable tableName="dwh_report_extract_seq">
            <column name="next_val" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="dwh_report_extract_seq_pk" />
            </column>
        </createTable>
        <sql>insert into ${db.schema.adapted}dwh_report_extract_seq values(1)</sql>
     </changeSet>
	<changeSet id="#3351_20180407" author="EdwardPLegaspi">
		<modifyDataType tableName="dwh_report_extract" columnName="sql_query" newDataType="text" />
	</changeSet> 
	<changeSet id="#1706_20180408" author="EdwardPLegaspi">
		<createTable tableName="billing_finance_segment">
			<column name="id" type="bigint" autoIncrement="${id.auto}">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_billing_finance_segment" />
            </column>
            <column name="code" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="description" type="varchar(255)" />
            <column name="version" type="int4" />
            <column name="disabled" type="${type.boolean}" defaultValueNumeric="0">
                <constraints nullable="false" />
            </column>
            <column name="created" type="datetime">
                <constraints nullable="false" />
            </column>
            <column name="updated" type="datetime" />
            <column name="creator" type="varchar(100)" />
            <column name="updater" type="varchar(100)" />
            <column name="object_class" type="varchar(100)">
            	<constraints nullable="false"/>
            </column>
            <column name="field" type="varchar(100)">
            	<constraints nullable="false"/>
            </column>
		</createTable>
		<addUniqueConstraint columnNames="code" tableName="billing_finance_segment"/>
		<createSequence sequenceName="billing_finance_segment_seq" />
	</changeSet>
	<changeSet id="#1706_20180408-M" author="EdwardPLegaspi" dbms="mysql">
        <createTable tableName="billing_finance_segment_seq">
            <column name="next_val" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_billing_finance_segment_seq" />
            </column>
        </createTable>
        <sql>insert into ${db.schema.adapted}billing_finance_segment_seq values(1)</sql>
    </changeSet>
	<changeSet id="#3019_20180312" author="AbdelmounaimAkadid">
        <addColumn tableName="billing_service_instance">
            <column name="minimum_amount_el" type="varchar(2000)"  />           
            <column name="minimum_label_el" type="varchar(2000)"  />           
        </addColumn>
        <addColumn tableName="cat_service_template">
            <column name="minimum_amount_el" type="varchar(2000)"  />           
            <column name="minimum_label_el" type="varchar(2000)"  />           
        </addColumn>
	</changeSet>
	<changeSet id="perf_cgi_20180426" author="Wassim" dbms="postgresql">
        <sql>DROP INDEX IF EXISTS ${db.schema.adapted}medina_access_subscription_id</sql>
        <sql>CREATE INDEX medina_access_subscription_id ON  ${db.schema.adapted}medina_access(subscription_id)</sql>
	</changeSet>
	<changeSet id="perf_cgi_20180426" author="Wassim" dbms="mysql">
        <sql>DROP INDEX IF EXISTS medina_access_subscription_id ON ${db.schema.adapted}medina_access</sql>
        <sql>CREATE INDEX medina_access_subscription_id ON ${db.schema.adapted}medina_access(subscription_id)</sql>
	</changeSet>   
	<changeSet id="#3436_20180508" author="EdwardPLegaspi">
		<modifyDataType tableName="dwh_measurable_quant" columnName="sql_query" newDataType="text" />
	</changeSet>

    <changeSet id="#1102_20160823" author="rachidAityaazza">
        <createTable tableName="CUST_CRT">
            <column name="id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="version" type="INT4" />
            <column name="disabled" type="${type.boolean}">
                <constraints nullable="false" />
            </column>
            <column name="created" type="datetime">
                <constraints nullable="false" />
            </column>
            <column name="updated" type="datetime" />
            <column name="description" type="VARCHAR(100)" />
            <column name="code" type="VARCHAR(50)" />
            <column name="provider_id" type="BIGINT" />
            <column name="creator" type="varchar(100)" />
            <column name="updater" type="varchar(100)" />
            <column name="name" type="VARCHAR(100)" />
            <column name="direction" type="VARCHAR(100)" />
            <column name="start_node_id" type="BIGINT" />
            <column name="end_node_id" type="BIGINT" />
            <column name="start_node_keys" type="VARCHAR(100)" />
            <column name="end_node_keys" type="VARCHAR(100)" />
            <column name="is_unique" type="${type.boolean}" defaultValueNumeric="0">
                <constraints nullable="false" />
            </column>
        </createTable>
        <createSequence sequenceName="cust_crt_seq"/>
        <addPrimaryKey columnNames="id" constraintName="cust_crt_pkey"
                       tableName="cust_crt" />

        <addForeignKeyConstraint baseColumnNames="provider_id"
                                 baseTableName="cust_crt" constraintName="fk_cust_crt_crm_provider"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_provider" />

        <addForeignKeyConstraint baseColumnNames="start_node_id"
                                 baseTableName="cust_crt" constraintName="fk_cust_crt_start_node"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cust_cet"/>

        <addForeignKeyConstraint baseColumnNames="end_node_id"
                                 baseTableName="cust_crt" constraintName="fk_cust_crt_end_node"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cust_cet"/>

    </changeSet>
    <changeSet id="#2289_20170202" author="rachidAityaazza">
        <modifyDataType tableName="CRM_CUSTOM_FIELD_TMPL" columnName="INDEX_TYPE" newDataType="VARCHAR(250)"/>
    </changeSet>
    <changeSet id="#2289_20170203" author="rachidAityaazza">
        <modifyDataType tableName="CUST_CEI" columnName="CODE" newDataType="VARCHAR(250)"/>
    </changeSet>
    <changeSet id="technical_services" author="Clément Bareth">
        <!-- Technical Services -->
        <createSequence sequenceName="technical_services_seq"/>
        <createTable tableName="technical_services">
            <column name="id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="version" type="INT4" />
            <column name="service_version" type="INT4" >
                <constraints nullable="false" />
            </column>
            <column name="created" type="datetime">
                <constraints nullable="false" />
            </column>
            <column name="disabled" type="INT4"/>
            <column name="updated" type="datetime" />
            <column name="creator" type="varchar(100)" />
            <column name="updater" type="varchar(100)" />
            <column name="description" type="varchar(255)" />
            <column name="code" type="varchar(255)" />
            <column name="script" type="text">
                <constraints nullable="false" />
            </column>
            <column name="name" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="service_type" type="varchar(100)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey tableName="technical_services" columnNames="id"/>
        <addUniqueConstraint columnNames="name,service_version" constraintName="technical_services_name_version"
                             deferrable="false" disabled="false" initiallyDeferred="false"
                             tableName="technical_services"/>
        <createIndex tableName="technical_services" indexName="technical_services_name_index">
            <column name="name"/>
        </createIndex>
        <!-- Descriptions -->
        <createSequence sequenceName="technical_services_description_seq"/>
        <createTable tableName="technical_services_description">
            <column name="id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="description_type" type="varchar(255)"/>
            <column name="service_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="input" defaultValue="false" type="boolean"/>
            <column name="output" defaultValue="false" type="boolean"/>
            <column name="entity_name" type="varchar(255)" />
            <column name="target_name" type="varchar(255)" />
            <column name="source_name" type="varchar(255)" />
            <column name="cet_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="crt_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey tableName="technical_services_description" columnNames="id" />
        <addForeignKeyConstraint baseTableName="technical_services_description" baseColumnNames="service_id"
                                 constraintName="fk_ts_desc_service_id" referencedTableName="technical_services"
                                 referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="technical_services_description" baseColumnNames="cet_id"
                                 constraintName="fk_ts_cet_id" referencedTableName="cust_cet"
                                 referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="technical_services_description" baseColumnNames="crt_id"
                                 constraintName="fk_ts_crt_id" referencedTableName="cust_crt"
                                 referencedColumnNames="id"/>
        <!-- Property description -->
        <createSequence sequenceName="property_description_seq"/>
        <createTable tableName="property_description">
            <column name="id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="description_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="cft_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="required" defaultValue="false" type="boolean"/>
            <column name="comparator" type="varchar(255)"/>
            <column name="comparison_value" type="varchar(255)"/>
            <column name="default_value" type="varchar(255)"/>
            <column name="trustness" type="INT"/>
            <column name="direction" type="varchar(255)"/>
        </createTable>
        <addPrimaryKey tableName="property_description" columnNames="id" />
        <addForeignKeyConstraint baseTableName="property_description" baseColumnNames="cft_id"
                                 constraintName="fk_prop_desc_cft_id" referencedTableName="crm_custom_field_tmpl"
                                 referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="property_description" baseColumnNames="description_id"
                                 constraintName="fk_prop_desc_desc_id" referencedTableName="technical_services_description"
                                 referencedColumnNames="id"/>
    </changeSet>
    <changeSet id="sequence_if_mysql" author="Clement Bareth" dbms="mysql">
        <createTable tableName="cust_crt_seq">
            <column name="next_val" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="cust_crt_seq_pk" />
            </column>
        </createTable>
        <sql>insert into ${db.schema.adapted}cust_crt_seq values(1)</sql>
        <createTable tableName="technical_services_description_seq">
            <column name="next_val" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="technical_services_description_seq_pk" />
            </column>
        </createTable>
        <sql>insert into ${db.schema.adapted}technical_services_description_seq values(1)</sql>
        <createTable tableName="property_description_seq">
            <column name="next_val" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="property_description_seq_pk" />
            </column>
        </createTable>
        <sql>insert into ${db.schema.adapted}property_description_seq values(1)</sql>
        <createTable tableName="technical_services_seq">
            <column name="next_val" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="technical_services_seq_pk" />
            </column>
        </createTable>
        <sql>insert into ${db.schema.adapted}technical_services_seq values(1)</sql>
    </changeSet>
    <changeSet id="cet_crt_labels" author="Clement Bareth">
        <createTable tableName="cet_labels">
            <column name="cet_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName=""/>
            </column>
            <column name="label" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint constraintName="cet_id_fk" baseTableName="cet_labels" baseColumnNames="cet_id"
                                 referencedTableName="cust_cet" referencedColumnNames="id"/>
        <addPrimaryKey tableName="cet_labels" columnNames="cet_id, label" constraintName="cet_label_pk"/>
    </changeSet>
    <changeSet id="cet_ref" author="Hien Bach">
        <createTable tableName="cet_ref">
            <column name="id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="cet_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName=""/>
            </column>
            <column name="created" type="datetime">
                <constraints nullable="false" />
            </column>
            <column name="updated" type="datetime" />
            <column name="creator" type="varchar(100)" />
            <column name="updater" type="varchar(100)" />
            <column name="version" type="INT4" />
            <column name="display_sub" type="${type.boolean}" defaultValueNumeric="0"/>
            <column name="label_cet" type="varchar(100)"/>
        </createTable>
        <addForeignKeyConstraint constraintName="cet_id_fk" baseTableName="cet_ref" baseColumnNames="cet_id"
                                 referencedTableName="cust_cet" referencedColumnNames="id"/>
        <addPrimaryKey tableName="cet_ref" columnNames="id" constraintName="cet_ref_pk"/>
    </changeSet>

    <changeSet id="pre_persist_script" author="Clement Bareth">
        <addColumn tableName="cust_cet">
            <column name="pre_persist_script" type="BIGINT" />
        </addColumn>
        <addForeignKeyConstraint baseColumnNames="pre_persist_script"
                                 baseTableName="cust_cet" constraintName="fk_cust_cet_pre_persist_script"
                                 deferrable="false" initiallyDeferred="false"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="meveo_script_instance" />
    </changeSet>

    <changeSet id="rename_and_add_function_version" author="Clement Bareth">
        <addColumn tableName="meveo_script_instance">
            <column name="function_version" type="INT4">
                <constraints nullable="false"/>
            </column>
        </addColumn>
        <renameColumn tableName="technical_services" oldColumnName="service_version" newColumnName="function_version"/>
    </changeSet>

    <changeSet id="setters_and_getters" author="Clement Bareth">
        <addColumn tableName="meveo_script_instance">
            <column name="getters" type="${type.json}"> </column>
        </addColumn>
        <addColumn tableName="meveo_script_instance">
            <column name="setters" type="${type.json}"> </column>
        </addColumn>
    </changeSet>

    <changeSet author="Aurélien PONÇON" id="cust_cet_unique_constraint#3394">
        <createSequence sequenceName="cust_cet_unique_constraint_seq"/>
        <createTable tableName="cust_cet_unique_constraint">
            <column name="id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="version" type="int4" />
            <column name="disabled" type="${type.boolean}">
                <constraints nullable="false" />
            </column>
            <column name="description" type="VARCHAR(100)" />
            <column name="code" type="VARCHAR(50)" />

            <column name="applies_to" type="VARCHAR(100)">
                <constraints nullable="false" />
            </column>
            <column name="cypher_query" type="text">
                <constraints nullable="false" />
            </column>
            <column name="trust_score" type="int4">
                <constraints nullable="false" />
            </column>
            <column name="applicable_on_el" type="varchar(2000)" />
            <column name="order" type="int4">
                <constraints nullable="false" />
            </column>
            <column name="created" type="datetime">
                <constraints nullable="false" />
            </column>
            <column name="updated" type="datetime" />
            <column name="creator" type="varchar(100)" />
            <column name="updater" type="varchar(100)" />
        </createTable>
        <addPrimaryKey tableName="cust_cet_unique_constraint" columnNames="id" constraintName="cust_cet_unique_constraint_pk"/>
        <addUniqueConstraint columnNames="applies_to, code" constraintName="cust_cet_unique_constraint_applies_to_code_idx"
                             deferrable="false" disabled="false" initiallyDeferred="false"
                             tableName="cust_cet_unique_constraint"/>
    </changeSet>


    <changeSet id = "createmeveo_function" author = "Hien Bach">
        <createSequence sequenceName="meveo_function_seq" />
        <createTable tableName="meveo_function">
            <column name="id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="version" type="INT4" />
            <column name="disabled" type="${type.boolean}">
                <constraints nullable="false" />
            </column>
            <column name="created" type="datetime">
                <constraints nullable="false" />
            </column>
            <column name="updated" type="datetime" />
            <column name="code" type="varchar(100)" defaultValue="default">
                <constraints nullable="false" />
            </column>
            <column name="description" type="varchar(100)" defaultValue="default"/>
            <column name="function_version" type="INT4" />
            <column name="creator" type="varchar(100)" defaultValue="default"/>
            <column name="updater" type="varchar(100)" defaultValue="default"/>
        </createTable>
        <addPrimaryKey tableName="meveo_function" columnNames="id"/>
    </changeSet>
    <changeSet id="insertmeveo_function" author = "Hien Bach">
        <sql>
            INSERT INTO meveo_function (creator, id, updated, updater, version, disabled, created, code, description, function_version)
            SELECT creator, id, updated, updater, version, disabled, created, code, description, function_version
            FROM meveo_script_instance;
        </sql>
        <sql>
            INSERT INTO meveo_function (creator, id, updated, updater, version, disabled, created, code, description, function_version)
            SELECT creator, id, updated, updater, version, disabled, created, code, description, function_version
            FROM technical_services;
        </sql>
    </changeSet>

    <changeSet id="selectmeveo_function_seq" author = "Clément Bareth">
        <comment>Currently only works for postgres</comment>
        <sql dbms="postgres">
            SELECT setval('meveo_function_seq', COALESCE((SELECT MAX(id)+1 FROM meveo_function), 1), false);
        </sql>
    </changeSet>

    <changeSet id="updatecolumnfunction_id" author = "Hien Bach">
        <renameColumn tableName="adm_notification" oldColumnName="script_instance_id" newColumnName="function_id"/>
    </changeSet>

    <changeSet id="foreignKeyfk_function_id" author = "Hien Bach">
        <addForeignKeyConstraint baseTableName="adm_notification" baseColumnNames="function_id"
                                 constraintName="fk_function_id" referencedTableName="meveo_function"
                                 referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="neo4j_configuration" author="Clément Bareth">
        <createTable tableName="neo4j_configuration">
            <column name="code" type="varchar(255)">
                <constraints primaryKey="true" primaryKeyName="pk_neo4_configuration" nullable="false"/>
            </column>
            <column name="neo4j_url" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="neo4j_login" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="neo4j_password" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id = "deleteproperty_description" author = "Hien Bach">
        <sql>
            DELETE FROM property_description WHERE 1 = 1
        </sql>
        <sql>
            DELETE FROM technical_services_description WHERE 1 = 1
        </sql>
    </changeSet>

    <changeSet id="dropForeignKeyConstrainttechnical" author = "Hien Bach">
        <dropForeignKeyConstraint baseTableName="technical_services_description" constraintName="fk_ts_desc_service_id"/>
    </changeSet>

    <changeSet id="foreignKeyTechnical" author = "Hien Bach">
        <addForeignKeyConstraint baseTableName="technical_services_description" baseColumnNames="service_id"
                                 constraintName="fk_ts_desc_service_id" referencedTableName="meveo_function"
                                 referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="droptabletechnical" author = "Hien Bach">
        <dropTable tableName="technical_services"/>
    </changeSet>

    <changeSet id="service_endpoint" author="Clément Bareth">
        <!-- Service endpoint -->
        <createTable tableName="service_endpoint">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="version" type="int4"/>
            <column name="disabled" type="${type.boolean}" defaultValueNumeric="0"/>
            <column name="created" type="datetime">
                <constraints nullable="false" />
            </column>
            <column name="updated" type="datetime" />
            <column name="description" type="VARCHAR(255)" />
            <column name="code" type="VARCHAR(255)">
                <constraints unique="true"/>
            </column>
            <column name="creator" type="varchar(255)"/>
            <column name="updater" type="varchar(255)"/>
            <column name="service_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="synchronous" type="${type.boolean}" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
            <column name="method" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint baseTableName="service_endpoint" baseColumnNames="service_id"
                                 constraintName="fk_service_endpoint_service_id" referencedTableName="meveo_function"
                                 referencedColumnNames="id" />
        <!-- Endpoint path parameter -->
        <createTable tableName="endpoint_path_parameter">
            <column name="endpoint_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="parameter_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="position" type="int4">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey constraintName="pk_endpoint_path_parameter" tableName="endpoint_path_parameter" columnNames="endpoint_id,parameter_id"/>
        <sql>
            ALTER TABLE endpoint_path_parameter
            ADD CONSTRAINT endpoint_path_parameter_pos_gt_zero
            CHECK (position >= 0);
        </sql>
        <addForeignKeyConstraint baseTableName="endpoint_path_parameter" baseColumnNames="endpoint_id"
                                 constraintName="fk_endpoint_path_parameter_endpoint_id" referencedTableName="service_endpoint"
                                 referencedColumnNames="id" />
        <addForeignKeyConstraint baseTableName="endpoint_path_parameter" baseColumnNames="parameter_id"
                                 constraintName="fk_endpoint_path_parameter_parameter_id" referencedTableName="property_description"
                                 referencedColumnNames="id" />
        <!-- Parameters mapping -->
        <createTable tableName="service_parameter_mapping">
            <column name="endpoint_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="parameter_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="parameter_name" type="varchar(255)" />
            <column name="default_value" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey constraintName="pk_service_parameter_mapping" tableName="service_parameter_mapping" columnNames="endpoint_id,parameter_id"/>
        <addForeignKeyConstraint baseTableName="service_parameter_mapping" baseColumnNames="endpoint_id"
                                 constraintName="fk_service_parameter_mapping_endpoint_id" referencedTableName="service_endpoint"
                                 referencedColumnNames="id" />
        <addForeignKeyConstraint baseTableName="service_parameter_mapping" baseColumnNames="parameter_id"
                                 constraintName="fk_service_parameter_mapping_parameter_id" referencedTableName="property_description"
                                 referencedColumnNames="id" />
    </changeSet>
    <changeSet id="#105_custom_entity_category" author="Luis Mance">
        <createTable tableName="cust_cec">
            <column name="id" type="bigint" autoIncrement="${id.auto}">
                <constraints nullable="false" primaryKey="true" primaryKeyName="cust_cec_pkey" />
            </column>
            <column name="version" type="int4" />
            <column name="disabled" type="${type.boolean}" defaultValueNumeric="0">
                <constraints nullable="false" />
            </column>
            <column name="created" type="datetime">
                <constraints nullable="false" />
            </column>
            <column name="updated" type="datetime" />
            <column name="description" type="varchar(255)" />
            <column name="code" type="varchar(255)" />

            <column name="creator" type="varchar(100)" />
            <column name="updater" type="varchar(100)" />

            <column name="name" type="varchar(100)">
                <constraints nullable="false" />
            </column>
        </createTable>
        <addColumn tableName="cust_cet">
            <column name="custom_entity_category" type="BIGINT" />
        </addColumn>
        <addForeignKeyConstraint baseColumnNames="custom_entity_category"
                                 baseTableName="cust_cet" constraintName="fk_cust_custom_entity_category_id"
                                 deferrable="false" initiallyDeferred="false" onDelete="SET NULL"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cust_cec"/>
    </changeSet>
    <changeSet id="Add_TestSuites" author="Clément Bareth">
        <addColumn tableName="meveo_function">
            <column name="test_suite" type="TEXT"/>
        </addColumn>
    </changeSet>
    <changeSet id="add_custom_entity_category" author="Phu Bach">
        <createSequence sequenceName="cust_cec_seq"/>
    </changeSet>
    <changeSet id="delete_code_created_updated_from_meveo_script_instance" author="Clément Bareth">
        <dropColumn tableName="meveo_script_instance" columnName="code"/>
        <dropColumn tableName="meveo_script_instance" columnName="created"/>
        <dropColumn tableName="meveo_script_instance" columnName="updated"/>
    </changeSet>

    <changeSet id="fix_unique_cet_constraint" author="Clément Bareth">
        <dropColumn tableName="cust_cet_unique_constraint" columnName="applies_to"/>
        <dropColumn tableName="cust_cet_unique_constraint" columnName="created"/>
        <dropColumn tableName="cust_cet_unique_constraint" columnName="updated"/>
        <dropColumn tableName="cust_cet_unique_constraint" columnName="creator"/>
        <dropColumn tableName="cust_cet_unique_constraint" columnName="updater"/>
        <dropColumn tableName="cust_cet_unique_constraint" columnName="version"/>
        <dropColumn tableName="cust_cet_unique_constraint" columnName="id"/>
        <dropColumn tableName="cust_cet_unique_constraint" columnName="disabled"/>
        <renameColumn tableName="cust_cet_unique_constraint" oldColumnName="order" newColumnName="position"/>
        <addColumn tableName="cust_cet_unique_constraint">
            <column name="cet_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </addColumn>
        <addPrimaryKey tableName="cust_cet_unique_constraint" columnNames="code, cet_id" constraintName="cust_cet_unique_constraint_pkey"/>
    </changeSet>

    <changeSet id="#3516_replace_node_and_relationships_classname_filter" author="Clément Bareth">
        <update tableName="adm_notification">
            <column name="class_name_filter" value="org.meveo.service.neo4j.graph.Neo4jEntity"/>
            <where>
                class_name_filter = 'org.neo4j.driver.v1.types.Node'
            </where>
        </update>
        <update tableName="adm_notification">
            <column name="class_name_filter" value="org.meveo.service.neo4j.graph.Neo4jRelationship"/>
            <where>
                class_name_filter = 'org.neo4j.driver.v1.types.Relationship'
            </where>
        </update>
    </changeSet>

    <changeSet id="rest_endpoint_add_jsonata" author="Clément Bareth">
        <addColumn tableName="service_endpoint">
            <column name="jsonata_transformer" type="varchar(255)"/>
        </addColumn>
    </changeSet>

    <changeSet id="endpoint_parmeter_id_string" author="Clément Bareth">
        <dropForeignKeyConstraint baseTableName="service_parameter_mapping" constraintName="fk_service_parameter_mapping_parameter_id"/>
        <dropForeignKeyConstraint baseTableName="endpoint_path_parameter" constraintName="fk_endpoint_path_parameter_parameter_id"/>
        <modifyDataType tableName="service_parameter_mapping" columnName="parameter_id" newDataType="varchar(255)"/>
        <modifyDataType tableName="endpoint_path_parameter" columnName="parameter_id" newDataType="varchar(255)"/>
        <addColumn tableName="service_parameter_mapping">
            <column name="multivalued" type="${type.boolean}">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="#3553" author="Clément Bareth">
        <addColumn tableName="cust_crt">
            <column name="source_name_singular" type="varchar(255)"/>
            <column name="source_name_plural" type="varchar(255)"/>
            <column name="target_name_singular" type="varchar(255)"/>
            <column name="target_name_plural" type="varchar(255)"/>
            <column name="graphql_type" type="varchar(255)"/>
        </addColumn>
    </changeSet>

    <changeSet id="#3555" author="Clément Bareth">
        <addColumn tableName="crm_custom_field_tmpl">
            <column name="identifier" type="int4"/>
        </addColumn>
        <update tableName="crm_custom_field_tmpl">
            <column name="identifier" value="0"/>
        </update>
    </changeSet>

    <changeSet id="#3557" author="Clément Bareth">
        <addColumn tableName="cust_cet">
            <column name="graphql_query_fields" type="${type.json}"/>
        </addColumn>
    </changeSet>

    <changeSet id="#3607_20190123" author="andrius.karpavicius">
        <addColumn tableName="cust_cet">
            <column name="store_as_table" type="${type.boolean}" defaultValueNumeric="0"/>
        </addColumn>
        <update  tableName="cust_cet">
            <column name="store_as_table" value="0"/>
        </update>
    </changeSet>

    <changeSet id="#3594_12042019" author="Clément Bareth">
        <addColumn tableName="crm_custom_field_tmpl">
            <column name="is_summary" type="${type.boolean}" defaultValueNumeric="0"/>
        </addColumn>
        <update  tableName="crm_custom_field_tmpl">
            <column name="is_summary" value="0"/>
        </update>
    </changeSet>
    <changeSet author="Hien Bach" id="meveo_script_inputs">
        <createTable tableName="meveo_script_inputs">
            <column name="meveo_script_instance_id" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="script_input" type="varchar(255)">
                <constraints nullable="false" />
            </column>
        </createTable>
        <addPrimaryKey columnNames="meveo_script_instance_id, script_input" constraintName="pk_meveo_script_inputs" tableName="meveo_script_inputs" />
    </changeSet>
    <changeSet author="Hien Bach" id="meveo_script_outputs">
        <createTable tableName="meveo_script_outputs">
            <column name="meveo_script_instance_id" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="script_output" type="varchar(255)">
                <constraints nullable="false" />
            </column>
        </createTable>
        <addPrimaryKey columnNames="meveo_script_instance_id, script_output" constraintName="pk_meveo_script_outputs" tableName="meveo_script_outputs" />
    </changeSet>

    <changeSet id="endpoint_returned_variable_name" author="Clément Bareth">
        <addColumn tableName="service_endpoint">
            <column name="returned_variable_name" type="varchar(50)"/>
        </addColumn>
    </changeSet>

    <changeSet id="endpoint_serialize result" author="Clément Bareth">
        <addColumn tableName="service_endpoint">
            <column name="serialize_result" type="${type.boolean}" valueNumeric="0" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="endpoint_serialize content_type" author="Clément Bareth">
        <addColumn tableName="service_endpoint">
            <column name="content_type" type="varchar(255)"/>
        </addColumn>
    </changeSet>

    <changeSet id="#3652-Available_storages" author="Clément Bareth">
        <addColumn tableName="cust_cet">
            <column name="available_storages" type="${type.json}"/>
        </addColumn>
    </changeSet>

    <changeSet id="add_unique_constraint_meveo_function_code" author="Clément Bareth" failOnError="false">
        <addUniqueConstraint tableName="meveo_function" columnNames="code" constraintName="meveo_function_unique_code"/>
    </changeSet>

    <changeSet id="#3655-Storages" author="Clément Bareth">
        <addColumn tableName="crm_custom_field_tmpl">
            <column name="storages" type="${type.json}"/>
        </addColumn>
    </changeSet>

    <changeSet id="technical_service_drop_notnull_consraint_crt_cet" author="Clément Bareth">
        <dropNotNullConstraint columnName="cet_id" tableName="technical_services_description"/>
        <dropNotNullConstraint columnName="crt_id" tableName="technical_services_description"/>
    </changeSet>

    <changeSet id="uuid-ossp" author="Clément Bareth" dbms="postgresql">
        <sql>CREATE EXTENSION IF NOT EXISTS "uuid-ossp";</sql>
    </changeSet>

    <changeSet id="crt_available_storages" author="Clément Bareth">
        <addColumn tableName="cust_crt">
            <column name="available_storages" type="${type.json}" defaultValue="[&quot;NEO4J&quot;]"/>
        </addColumn>
    </changeSet>

    <changeSet id="use_uuid_unique_constraint" author="Clément Bareth">
        <sql>UPDATE cust_cet_unique_constraint SET cypher_query = regexp_replace(cypher_query, '(?:ID)\((\w+)\)', '\1.meveo_uuid')</sql>
    </changeSet>

    <changeSet id="cft_format_date" author="Hien Bach">
        <addColumn tableName="crm_custom_field_tmpl">
            <column name="display_format" type="varchar(255)"/>
        </addColumn>
    </changeSet>

    <changeSet id="#3718" author="HienBach">
        <addColumn tableName="cust_cet">
            <column name="max_value" type="bigint"/>
        </addColumn>
    </changeSet>

    <changeSet id="nationality column in adm_country table" author="Phu Bach">
        <addColumn tableName="adm_country">
            <column name="nationality" type="varchar(255)"/>
        </addColumn>
    </changeSet>
    <changeSet id="update nationality in adm_country table" author="Phu Bach">
        <sql>
            update adm_country set nationality='Afghan' where country_code='AF';
            update adm_country set nationality='Aland Island' where country_code='AX';
            update adm_country set nationality='Albanian' where country_code='AL';
            update adm_country set nationality='Algerian' where country_code='DZ';
            update adm_country set nationality='American Samoan' where country_code='AS';
            update adm_country set nationality='Andorran' where country_code='AD';
            update adm_country set nationality='Angolan' where country_code='AO';
            update adm_country set nationality='Anguillan' where country_code='AI';
            update adm_country set nationality='Antarctic' where country_code='AQ';
            update adm_country set nationality='Antiguan or Barbudan' where country_code='AG';
            update adm_country set nationality='Argentine' where country_code='AR';
            update adm_country set nationality='Armenian' where country_code='AM';
            update adm_country set nationality='Netherlands Antilles' where country_code='AN';
            update adm_country set nationality='Aruban' where country_code='AW';
            update adm_country set nationality='Australian' where country_code='AU';
            update adm_country set nationality='Austrian' where country_code='AT';
            update adm_country set nationality='Azerbaijani' where country_code='AZ';
            update adm_country set nationality='Bahamian' where country_code='BS';
            update adm_country set nationality='Bahraini' where country_code='BH';
            update adm_country set nationality='Bangladeshi' where country_code='BD';
            update adm_country set nationality='Barbadian' where country_code='BB';
            update adm_country set nationality='Belarusian' where country_code='BY';
            update adm_country set nationality='Belgian' where country_code='BE';
            update adm_country set nationality='Belizean' where country_code='BZ';
            update adm_country set nationality='Beninese' where country_code='BJ';
            update adm_country set nationality='Bermudian' where country_code='BM';
            update adm_country set nationality='Bhutanese' where country_code='BT';
            update adm_country set nationality='Bolivian' where country_code='BO';
            update adm_country set nationality='Sint Eustatius and Saba' where country_code='BQ';
            update adm_country set nationality='Bosnian or Herzegovinian' where country_code='BA';
            update adm_country set nationality='Motswana' where country_code='BW';
            update adm_country set nationality='Bouvet Island' where country_code='BV';
            update adm_country set nationality='Brazilian' where country_code='BR';
            update adm_country set nationality='BIOT' where country_code='IO';
            update adm_country set nationality='Bruneian' where country_code='BN';
            update adm_country set nationality='Bulgarian' where country_code='BG';
            update adm_country set nationality='Burkinabe' where country_code='BF';
            update adm_country set nationality='Burundian' where country_code='BI';
            update adm_country set nationality='Cabo Verdean' where country_code='CV';
            update adm_country set nationality='Cambodian' where country_code='KH';
            update adm_country set nationality='Cameroonian' where country_code='CM';
            update adm_country set nationality='Canadian' where country_code='CA';
            update adm_country set nationality='Caymanian' where country_code='KY';
            update adm_country set nationality='Central African' where country_code='CF';
            update adm_country set nationality='Chadian' where country_code='TD';
            update adm_country set nationality='Chilean' where country_code='CL';
            update adm_country set nationality='Chinese' where country_code='CN';
            update adm_country set nationality='Christmas Island' where country_code='CX';
            update adm_country set nationality='Cocos Island' where country_code='CC';
            update adm_country set nationality='Colombian' where country_code='CO';
            update adm_country set nationality='Comoran' where country_code='KM';
            update adm_country set nationality='Congolese' where country_code='CG';
            update adm_country set nationality='Congolese' where country_code='CD';
            update adm_country set nationality='Cook Island' where country_code='CK';
            update adm_country set nationality='Costa Rican' where country_code='CR';
            update adm_country set nationality='Ivorian' where country_code='CI';
            update adm_country set nationality='Croatian' where country_code='HR';
            update adm_country set nationality='Cuban' where country_code='CU';
            update adm_country set nationality='Curaçaoan' where country_code='CW';
            update adm_country set nationality='Cypriot' where country_code='CY';
            update adm_country set nationality='Czech' where country_code='CZ';
            update adm_country set nationality='Danish' where country_code='DK';
            update adm_country set nationality='Djiboutian' where country_code='DJ';
            update adm_country set nationality='Dominican' where country_code='DM';
            update adm_country set nationality='Dominican' where country_code='DO';
            update adm_country set nationality='Ecuadorian' where country_code='EC';
            update adm_country set nationality='Egyptian' where country_code='EG';
            update adm_country set nationality='Salvadoran' where country_code='SV';
            update adm_country set nationality='Equatorial Guinean' where country_code='GQ';
            update adm_country set nationality='Eritrean' where country_code='ER';
            update adm_country set nationality='Estonian' where country_code='EE';
            update adm_country set nationality='Ethiopian' where country_code='ET';
            update adm_country set nationality='Falkland Island' where country_code='FK';
            update adm_country set nationality='Faroese' where country_code='FO';
            update adm_country set nationality='Fijian' where country_code='FJ';
            update adm_country set nationality='Finnish' where country_code='FI';
            update adm_country set nationality='French' where country_code='FR';
            update adm_country set nationality='French Guianese' where country_code='GF';
            update adm_country set nationality='French Polynesian' where country_code='PF';
            update adm_country set nationality='French Southern Territories' where country_code='TF';
            update adm_country set nationality='Gabonese' where country_code='GA';
            update adm_country set nationality='Gambian' where country_code='GM';
            update adm_country set nationality='Georgian' where country_code='GE';
            update adm_country set nationality='German' where country_code='DE';
            update adm_country set nationality='Ghanaian' where country_code='GH';
            update adm_country set nationality='Gibraltar' where country_code='GI';
            update adm_country set nationality='Greek' where country_code='GR';
            update adm_country set nationality='Greenlandic' where country_code='GL';
            update adm_country set nationality='Grenadian' where country_code='GD';
            update adm_country set nationality='Guadeloupe' where country_code='GP';
            update adm_country set nationality='Guamanian' where country_code='GU';
            update adm_country set nationality='Guatemalan' where country_code='GT';
            update adm_country set nationality='Channel Island' where country_code='GG';
            update adm_country set nationality='Guinean' where country_code='GN';
            update adm_country set nationality='Bissau-Guinean' where country_code='GW';
            update adm_country set nationality='Guyanese' where country_code='GY';
            update adm_country set nationality='Haitian' where country_code='HT';
            update adm_country set nationality='Heard Island or McDonald Islands' where country_code='HM';
            update adm_country set nationality='Vatican' where country_code='VA';
            update adm_country set nationality='Honduran' where country_code='HN';
            update adm_country set nationality='Hong Kong' where country_code='HK';
            update adm_country set nationality='Hungarian' where country_code='HU';
            update adm_country set nationality='Icelandic' where country_code='IS';
            update adm_country set nationality='Indian' where country_code='IN';
            update adm_country set nationality='Indonesian' where country_code='ID';
            update adm_country set nationality='Iranian' where country_code='IR';
            update adm_country set nationality='Iraqi' where country_code='IQ';
            update adm_country set nationality='Irish' where country_code='IE';
            update adm_country set nationality='Manx' where country_code='IM';
            update adm_country set nationality='Israeli' where country_code='IL';
            update adm_country set nationality='Italian' where country_code='IT';
            update adm_country set nationality='Jamaican' where country_code='JM';
            update adm_country set nationality='Japanese' where country_code='JP';
            update adm_country set nationality='Channel Island' where country_code='JE';
            update adm_country set nationality='Jordanian' where country_code='JO';
            update adm_country set nationality='Kazakhstani' where country_code='KZ';
            update adm_country set nationality='Kenyan' where country_code='KE';
            update adm_country set nationality='I-Kiribati' where country_code='KI';
            update adm_country set nationality='North Korean' where country_code='KP';
            update adm_country set nationality='South Korean' where country_code='KR';
            update adm_country set nationality='Kuwaiti' where country_code='KW';
            update adm_country set nationality='Kyrgyzstani' where country_code='KG';
            update adm_country set nationality='Lao' where country_code='LA';
            update adm_country set nationality='Latvian' where country_code='LV';
            update adm_country set nationality='Lebanese' where country_code='LB';
            update adm_country set nationality='Basotho' where country_code='LS';
            update adm_country set nationality='Liberian' where country_code='LR';
            update adm_country set nationality='Libyan' where country_code='LY';
            update adm_country set nationality='Liechtenstein' where country_code='LI';
            update adm_country set nationality='Lithuanian' where country_code='LT';
            update adm_country set nationality='Luxembourg' where country_code='LU';
            update adm_country set nationality='Macanese' where country_code='MO';
            update adm_country set nationality='Macedonian' where country_code='MK';
            update adm_country set nationality='Malagasy' where country_code='MG';
            update adm_country set nationality='Malawian' where country_code='MW';
            update adm_country set nationality='Malaysian' where country_code='MY';
            update adm_country set nationality='Maldivian' where country_code='MV';
            update adm_country set nationality='Malian' where country_code='ML';
            update adm_country set nationality='Maltese' where country_code='MT';
            update adm_country set nationality='Marshallese' where country_code='MH';
            update adm_country set nationality='Martiniquais' where country_code='MQ';
            update adm_country set nationality='Mauritanian' where country_code='MR';
            update adm_country set nationality='Mauritian' where country_code='MU';
            update adm_country set nationality='Mahoran' where country_code='YT';
            update adm_country set nationality='Mexican' where country_code='MX';
            update adm_country set nationality='Micronesian' where country_code='FM';
            update adm_country set nationality='Moldovan' where country_code='MD';
            update adm_country set nationality='Monegasque' where country_code='MC';
            update adm_country set nationality='Mongolian' where country_code='MN';
            update adm_country set nationality='Montenegrin' where country_code='ME';
            update adm_country set nationality='Montserratian' where country_code='MS';
            update adm_country set nationality='Moroccan' where country_code='MA';
            update adm_country set nationality='Mozambican' where country_code='MZ';
            update adm_country set nationality='Burmese' where country_code='MM';
            update adm_country set nationality='Namibian' where country_code='NA';
            update adm_country set nationality='Nauruan' where country_code='NR';
            update adm_country set nationality='Nepali' where country_code='NP';
            update adm_country set nationality='Dutch' where country_code='NL';
            update adm_country set nationality='New Caledonian' where country_code='NC';
            update adm_country set nationality='New Zealand' where country_code='NZ';
            update adm_country set nationality='Nicaraguan' where country_code='NI';
            update adm_country set nationality='Nigerien' where country_code='NE';
            update adm_country set nationality='Nigerian' where country_code='NG';
            update adm_country set nationality='Niuean' where country_code='NU';
            update adm_country set nationality='Norfolk Island' where country_code='NF';
            update adm_country set nationality='Northern Marianan' where country_code='MP';
            update adm_country set nationality='Norwegian' where country_code='NO';
            update adm_country set nationality='Omani' where country_code='OM';
            update adm_country set nationality='Pakistani' where country_code='PK';
            update adm_country set nationality='Palauan' where country_code='PW';
            update adm_country set nationality='State of' where country_code='PS';
            update adm_country set nationality='Panamanian' where country_code='PA';
            update adm_country set nationality='Papua New Guinean' where country_code='PG';
            update adm_country set nationality='Paraguayan' where country_code='PY';
            update adm_country set nationality='Peruvian' where country_code='PE';
            update adm_country set nationality='Philippine' where country_code='PH';
            update adm_country set nationality='Pitcairn Island' where country_code='PN';
            update adm_country set nationality='Polish' where country_code='PL';
            update adm_country set nationality='Portuguese' where country_code='PT';
            update adm_country set nationality='Puerto Rican' where country_code='PR';
            update adm_country set nationality='Qatari' where country_code='QA';
            update adm_country set nationality='Reunionese' where country_code='RE';
            update adm_country set nationality='Romanian' where country_code='RO';
            update adm_country set nationality='Russian' where country_code='RU';
            update adm_country set nationality='Rwandan' where country_code='RW';
            update adm_country set nationality='Barthélemois' where country_code='BL';
            update adm_country set nationality='Ascension and Tristan da Cunha' where country_code='SH';
            update adm_country set nationality='Kittitian or Nevisian' where country_code='KN';
            update adm_country set nationality='Saint Lucian' where country_code='LC';
            update adm_country set nationality='Saint-Martinoise' where country_code='MF';
            update adm_country set nationality='Saint-Pierrais or Miquelonnais' where country_code='PM';
            update adm_country set nationality='Saint Vincentian' where country_code='VC';
            update adm_country set nationality='Samoan' where country_code='WS';
            update adm_country set nationality='Sammarinese' where country_code='SM';
            update adm_country set nationality='Sao Tomean' where country_code='ST';
            update adm_country set nationality='Saudi' where country_code='SA';
            update adm_country set nationality='Senegalese' where country_code='SN';
            update adm_country set nationality='Serbian' where country_code='RS';
            update adm_country set nationality='Seychellois' where country_code='SC';
            update adm_country set nationality='Sierra Leonean' where country_code='SL';
            update adm_country set nationality='Singaporean' where country_code='SG';
            update adm_country set nationality='Sint Maarten' where country_code='SX';
            update adm_country set nationality='Slovak' where country_code='SK';
            update adm_country set nationality='Slovenian' where country_code='SI';
            update adm_country set nationality='Solomon Island' where country_code='SB';
            update adm_country set nationality='Somali' where country_code='SO';
            update adm_country set nationality='South African' where country_code='ZA';
            update adm_country set nationality='South Georgia or South Sandwich Islands' where country_code='GS';
            update adm_country set nationality='South Sudanese' where country_code='SS';
            update adm_country set nationality='Spanish' where country_code='ES';
            update adm_country set nationality='Sri Lankan' where country_code='LK';
            update adm_country set nationality='Sudanese' where country_code='SD';
            update adm_country set nationality='Surinamese' where country_code='SR';
            update adm_country set nationality='Svalbard' where country_code='SJ';
            update adm_country set nationality='Swazi' where country_code='SZ';
            update adm_country set nationality='Swedish' where country_code='SE';
            update adm_country set nationality='Swiss' where country_code='CH';
            update adm_country set nationality='Syrian' where country_code='SY';
            update adm_country set nationality='Province of China' where country_code='TW';
            update adm_country set nationality='Tajikistani' where country_code='TJ';
            update adm_country set nationality='United Republic of' where country_code='TZ';
            update adm_country set nationality='Thai' where country_code='TH';
            update adm_country set nationality='Timorese' where country_code='TL';
            update adm_country set nationality='Togolese' where country_code='TG';
            update adm_country set nationality='Tokelauan' where country_code='TK';
            update adm_country set nationality='Tongan' where country_code='TO';
            update adm_country set nationality='Trinidadian or Tobagonian' where country_code='TT';
            update adm_country set nationality='Tunisian' where country_code='TN';
            update adm_country set nationality='Turkish' where country_code='TR';
            update adm_country set nationality='Turkmen' where country_code='TM';
            update adm_country set nationality='Turks and Caicos Island' where country_code='TC';
            update adm_country set nationality='Tuvaluan' where country_code='TV';
            update adm_country set nationality='Ugandan' where country_code='UG';
            update adm_country set nationality='Ukrainian' where country_code='UA';
            update adm_country set nationality='Emirati' where country_code='AE';
            update adm_country set nationality='British' where country_code='GB';
            update adm_country set nationality='American' where country_code='UM';
            update adm_country set nationality='American' where country_code='US';
            update adm_country set nationality='Uruguayan' where country_code='UY';
            update adm_country set nationality='Uzbekistani' where country_code='UZ';
            update adm_country set nationality='Ni-Vanuatu' where country_code='VU';
            update adm_country set nationality='Venezuelan' where country_code='VE';
            update adm_country set nationality='Vietnamese' where country_code='VN';
            update adm_country set nationality='British Virgin Island' where country_code='VG';
            update adm_country set nationality='U.S. Virgin Island' where country_code='VI';
            update adm_country set nationality='Wallis and Futuna' where country_code='WF';
            update adm_country set nationality='Sahrawi' where country_code='EH';
            update adm_country set nationality='Yemeni' where country_code='YE';
            update adm_country set nationality='Yugoslavia' where country_code='YU';
            update adm_country set nationality='Zambian' where country_code='ZM';
            update adm_country set nationality='Zimbabwean' where country_code='ZW';
        </sql>
    </changeSet>

    <changeSet id="binary_storage_configuration"
               author="Edward P. Legaspi">
        <createTable tableName="binary_storage_configuration">
            <column name="id" type="bigint" autoIncrement="${id.auto}">
                <constraints nullable="false" primaryKey="true"
                             primaryKeyName="binary_storage_configuration_pkey" />
            </column>
            <column name="version" type="int4" />
            <column name="code" type="varchar(255)">
                <constraints nullable="false" unique="true" />
            </column>
            <column name="root_path" type="varchar(255)">
                <constraints nullable="false" unique="true" />
            </column>
        </createTable>
        <createSequence
                sequenceName="binary_storage_configuration_seq" />
    </changeSet>

    <changeSet id="binary_storage_configuration_seq_mysql" author="Edward P. Legaspi"
               dbms="mysql">
        <createTable tableName="binary_storage_configuration_seq">
            <column name="next_val" type="BIGINT">
                <constraints nullable="false" primaryKey="true"
                             primaryKeyName="binary_storage_configuration_seq_pk" />
            </column>
        </createTable>
        <sql>insert into ${db.schema.adapted}binary_storage_configuration_seq values(1)</sql>
    </changeSet>

    <changeSet id="#3726 - Add storage repository"
               author="Edward P. Legaspi">
        <createTable tableName="storage_repository">
            <column name="id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="version" type="INT4" />
            <column name="disabled" type="${type.boolean}">
                <constraints nullable="false" />
            </column>
            <column name="created" type="datetime">
                <constraints nullable="false" />
            </column>
            <column name="updated" type="datetime" />
            <column name="description" type="VARCHAR(100)" />
            <column name="code" type="VARCHAR(50)" />
            <column name="creator" type="varchar(100)" />
            <column name="updater" type="varchar(100)" />
            <column name="data_separation_type" type="VARCHAR(25)"></column>

            <column name="parent_id" type="BIGINT" />
            <column name="binary_storage_configuration_id" type="BIGINT" />
            <column name="path" type="VARCHAR(255)"></column>
        </createTable>

        <addPrimaryKey tableName="storage_repository" columnNames="id"/>
        <createSequence
                sequenceName="storage_repository_seq" />
        <addForeignKeyConstraint
                constraintName="storage_repository_parent_fk"
                referencedTableName="storage_repository" baseColumnNames="parent_id"
                baseTableName="storage_repository" referencedColumnNames="id" />
        <addForeignKeyConstraint
                constraintName="binary_storage_configuration_fk"
                referencedTableName="binary_storage_configuration"
                baseColumnNames="binary_storage_configuration_id"
                baseTableName="storage_repository" referencedColumnNames="id" />
    </changeSet>

    <changeSet
            id="#3726 - Add storage repository sequence (mysql)"
            author="Edward P. Legaspi" dbms="mysql">
        <createTable tableName="storage_repository_seq">
            <column name="next_val" type="BIGINT">
                <constraints nullable="false" primaryKey="true"
                             primaryKeyName="storage_repository_seq_pk" />
            </column>
        </createTable>
        <sql>insert into ${db.schema.adapted}storage_repository_seq
            values(1)
        </sql>
    </changeSet>

    <changeSet
            id="#3726 - Convert neo4jConfiguration to businessEntity"
            author="Edward P. Legaspi">
        <createSequence sequenceName="neo4j_configuration_seq" />
        <addColumn tableName="neo4j_configuration">
            <column name="id" type="BIGINT" defaultValueSequenceNext="neo4j_configuration_seq"></column>
            <column name="version" type="INT4" />
            <column name="disabled" type="${type.boolean}"
                    defaultValue="0">
                <constraints nullable="true" />
            </column>
            <column name="created" type="datetime">
                <constraints nullable="true" />
            </column>
            <column name="updated" type="datetime" />
            <column name="description" type="VARCHAR(100)" />
            <column name="creator" type="varchar(100)" />
            <column name="updater" type="varchar(100)" />
        </addColumn>

        <update tableName="neo4j_configuration">
            <column name="created" type="datetime" value="${now()}"></column>
            <column name="version" value="0"></column>
            <column name="creator" value="MEVEO.ADMIN"></column>
        </update>

        <dropPrimaryKey tableName="neo4j_configuration" />

        <addNotNullConstraint
                tableName="neo4j_configuration" columnName="id" />
        <addNotNullConstraint
                tableName="neo4j_configuration" columnName="created" />
        <addPrimaryKey tableName="neo4j_configuration"
                       columnNames="id" constraintName="pk_neo4_configuration" />

        <addColumn tableName="storage_repository">
            <column name="neo4j_configuration_id" type="BIGINT"></column>
        </addColumn>

        <addForeignKeyConstraint
                constraintName="neo4j_configuration_id_fk"
                referencedTableName="neo4j_configuration"
                baseColumnNames="neo4j_configuration_id"
                baseTableName="storage_repository" referencedColumnNames="id" />
    </changeSet>

    <changeSet id="#3705 - Binary CFT type" author="EdwardPLegaspi">
        <addColumn tableName="crm_custom_field_tmpl">
            <column name="content_types" type="VARCHAR(2000)"></column>
            <column name="file_extensions" type="VARCHAR(2000)"></column>
            <column name="max_file_size_allowed_kb" type="BIGINT"></column>
            <column name="file_path" type="VARCHAR(255)"></column>
        </addColumn>
    </changeSet>

    <changeSet id="fix_meveo_function_code_length" author="Aurélien Ponçon">
        <modifyDataType tableName="meveo_function" columnName="code" newDataType="varchar(255)"/>
    </changeSet>

    <changeSet id="drop_meveo_script_instance_function_version_column" author="Aurélien Ponçon">
        <dropColumn tableName="meveo_script_instance" columnName="function_version" />
    </changeSet>

    <changeSet id="#3815 - Binary Storage - Save on explorer param should be at CFT level" author="ClémentBareth">
        <addColumn tableName="crm_custom_field_tmpl">
            <column name="save_on_explorer" type="${type.boolean}"/>
        </addColumn>
    </changeSet>

    <changeSet id="#3815 - Binary Storage - Save on explorer param should be at CFT level - Set  default value" author="ClémentBareth">
        <update tableName="crm_custom_field_tmpl">
            <column name="save_on_explorer" value="0"/>
        </update>
    </changeSet>

    <changeSet id="Binary Storage - Save on explorer - Set  default value on column" author="ClémentBareth">
        <addDefaultValue tableName="crm_custom_field_tmpl" columnName="save_on_explorer" defaultValue="0"/>
    </changeSet>

    <changeSet id="service_endpoint_roles" author="Hien Bach">
        <createTable tableName="service_endpoint_roles">
            <column name="endpoint_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName=""/>
            </column>
            <column name="role" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint constraintName="fk_service_endpoint_roles_id" baseTableName="service_endpoint_roles" baseColumnNames="endpoint_id"
                                 referencedTableName="service_endpoint" referencedColumnNames="id"/>
        <addPrimaryKey tableName="service_endpoint_roles" columnNames="endpoint_id, role" constraintName="service_endpoint_role_pkey"/>
    </changeSet>

    <changeSet id="#3821" author="Hien Bach">
        <addColumn tableName="crm_custom_field_tmpl">
            <column name="samples" type="text" defaultValue="[]"/>
        </addColumn>
    </changeSet>
    
   	<changeSet id="#4138 - Remove unused jobs" author="Edward P. Legaspi">
		<delete tableName="meveo_job_instance">
			<where>id IN (-1,-2,-3,-4,-5,-6,-7,-8,-9,-10,-11,-12,-13,-14,-15)</where>
		</delete>
	</changeSet>
</databaseChangeLog>